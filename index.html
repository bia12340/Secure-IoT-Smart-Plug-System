<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Home Pro</title>
    <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
    <style>
        :root { --bg: #0f172a; --card: #1e293b; --accent: #38bdf8; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: white; display: flex; flex-direction: column; align-items: center; min-height: 100vh; margin: 0; padding: 20px; }
        h1 { font-size: 1.8rem; margin-bottom: 5px; color: var(--accent); }
        .status-bar { font-size: 0.9rem; margin-bottom: 30px; transition: 0.3s; }
        
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 20px; width: 100%; max-width: 500px; }
        .socket-card { background: var(--card); padding: 25px; border-radius: 24px; text-align: center; box-shadow: 0 10px 25px rgba(0,0,0,0.2); transition: 0.3s; border: 1px solid #334155; }
        
        /* Butonul Toggle Pro */
        .btn { width: 80px; height: 80px; border-radius: 50%; border: none; cursor: pointer; background: #334155; color: white; font-size: 24px; transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); position: relative; box-shadow: 0 4px 0 #1e293b; }
        .btn.active { background: #22c55e; color: white; box-shadow: 0 0 20px rgba(34, 197, 94, 0.5); transform: translateY(-2px); }
        .btn:active { transform: translateY(2px); box-shadow: none; }
        
        .label { margin-top: 15px; font-weight: 600; font-size: 1.1rem; display: block; }
        .state-text { font-size: 0.8rem; opacity: 0.6; display: block; margin-top: 5px; }
    </style>
</head>
<body>
    <h1>Smart Control</h1>
    <div id="status" class="status-bar">Connecting...</div>

    <div class="grid">
        <div class="socket-card">
            <button id="btn1" class="btn" onclick="toggle(1)">ðŸ”Œ</button>
            <span class="label">Socket 1</span>
            <span id="state1" class="state-text">OFF</span>
        </div>
        <div class="socket-card">
            <button id="btn2" class="btn" onclick="toggle(2)">ðŸ”Œ</button>
            <span class="label">Socket 2</span>
            <span id="state2" class="state-text">OFF</span>
        </div>
        <div class="socket-card">
            <button id="btn3" class="btn" onclick="toggle(3)">ðŸ”Œ</button>
            <span class="label">Socket 3</span>
            <span id="state3" class="state-text">OFF</span>
        </div>
    </div>

    <script>
        const client = mqtt.connect('wss://broker.hivemq.com:8884/mqtt');
        const topicCmd = 'casa/priza/comenzi';
        const topicStatus = 'casa/priza/status';

        client.on('connect', () => {
            document.getElementById('status').innerText = "System Online âœ…";
            document.getElementById('status').style.color = "#22c55e";
            client.subscribe(topicStatus);
        });

        // Ascultam feedback-ul de la ESP32
        client.on('message', (topic, payload) => {
            const msg = payload.toString();
            const [id, state] = msg.split(':'); // Format asteptat "1:ON"
            updateUI(id, state);
        });

        function toggle(id) {
            client.publish(topicCmd, id + "_TOGGLE");
        }

        function updateUI(id, state) {
            const btn = document.getElementById('btn' + id);
            const text = document.getElementById('state' + id);
            if(state === "ON") {
                btn.classList.add('active');
                text.innerText = "ACTIVE";
                text.style.color = "#22c55e";
            } else {
                btn.classList.remove('active');
                text.innerText = "OFF";
                text.style.color = "white";
            }
        }
    </script>
</body>
</html>